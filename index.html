<!DOCTYPE html>
<html>
<head>
  <title>PicoDrop™</title>
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js" charset="utf-8"></script>
  <style>
    .title-intro {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 20vh;
    font-family: Arial, sans-serif;

    }

    .button {
      padding: 15px 32px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 10px 5px;
      cursor: pointer;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      width: 45%;
      font-family: Arial, sans-serif;
    }

    .container-wrapper {
        display: flex;
        justify-content: space-between;
    }   

    #number {
      font-size: 24px;
      margin-bottom: 20px;
    }

    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 5px;
    }
  </style>
</head>
<body>
    <div class="title-intro">
        <h1>PicoDrop™</h1>
        <p><i>Digitally measure DNA concentration and quality with equivalent reproducibility as a spectrophotometer!</i></p> 
    </div>
    <div class="container-wrapper">
        <div class="container" id="Individual Sample">
            <h2>Samples</h2>
            <button onclick="blank()">Blank with H2O</button>
            <button onclick="generateSample()">Measure</button>

            <p id="concentration"></p>
            <p id="A260/A280"></p>
            <p id="A260/A230"></p>
        </div>
        <div class="container" id="AbsorbanceSpectra">
            <h2>Absorbance Spectra</h2>
            <div id="absorbanceSpectraPlot" style="width:600px;height:250px;"></div>
        </div>
        <div class="container" id="sampleTableContainer">
            <h2>Sample Table</h2>
            <button onclick="clearTable()">Clear Table</button> 
            <table id="samplesTable">
                <tr>
                    <th>#</th>
                    <th>ng/uL</th>
                    <th>A260/A280</th>
                    <th>A260/A230</th>
                </tr>
            </table>
        </div>
    </div>

  <script>
    // Initializations for page.
    var sampleCount = 0;
    var blanked = false;
    var pathLength = 10.0; // mm
    var AbsorbanceToConcentrationFactor = 500 ; // ng/uL per A260 * pathLength

    // Initialize the absorbance spectra plot.
    absorbanceSpectraPlotElement = document.getElementById('absorbanceSpectraPlot');
	Plotly.newPlot( absorbanceSpectraPlotElement, [{
	    x: [],
	    y: [] }], 
        {margin: { t: 0 },
        xaxis: {
            title: "Wavelength (nm)",
            range: [220, 350]

            },
        yaxis: {
            title: "10mm Absorbance"
            }     
        } 
    
    );

    // Function definitions

    // Generate sample values (concentration, A260/A280, A260/A230)
    function generateSample() {

        // Keep track of sample numberfor each measure.
        sampleCount++;

        if (blanked == false) {
            // set randomConcentration to a random number between -20.0 and 1.0
            var Concentration = (Math.random() * (1.0 + 20.0) - 20.0).toFixed(2);
            // set randomA260A280 to a random number between -0.5 and 0.5
            var A260A280 = (Math.random() * (0.5 + 0.5) - 0.5).toFixed(2);
            // set randomA260A230 to a random number between -0.5 and 0.5
            var A260A230 = (Math.random() * (0.5 + 0.5) - 0.5).toFixed(2);
            // set background signal to a random number between -4.5 and 5
            var backgroundSignal = (Math.random() * (5.0 + 4.5) - 4.5).toFixed(2);

        }
        else {
            var Concentration = (Math.random() * 101,3).toFixed(2); // Generates a random number from 0 to 100
            if (Math.random() < 0.9) {
                var A260A280 = (Math.random() * (2. - 1.8) + 1.8).toFixed(2);
            } else {
                var A260A280 = (Math.random() * 0.5).toFixed(2);
            }
            // set randomA260A230 to a random number between 2.0 and 2.2 90% of the time and between 0.0 and 1.0 10% of the time
            if (Math.random() < 0.9) {
                var A260A230 = (Math.random() * (2.2 - 2.0) + 2.0).toFixed(2);
            } else {
                var A260A230 = (Math.random() * 1.0).toFixed(2);
            }
            // set background signal to a random number between -0.1 and 0.1
            var backgroundSignal = (Math.random() * (0.1 + 0.1) - 0.1).toFixed(2);
        }
        
        // Report the values of the current sample
        document.getElementById("concentration").textContent = "Generated Number: " + Concentration + " ng/uL";
        document.getElementById("A260/A280").textContent = "A260/A280: " + A260A280;
        document.getElementById("A260/A230").textContent = "A260/A230: " + A260A230;

        
        
        // Add current sample to the table.
        var table = document.getElementById("samplesTable");
        var row = table.insertRow(-1);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);

        cell1.innerHTML = sampleCount;
        cell2.innerHTML = Concentration;
        cell3.innerHTML = A260A280;
        cell4.innerHTML = A260A230;

        // Plot the absorbance spectrum of the current sample
        addAbsorbanceSpectrum();
   
    }

    // Add the sample's absorbance spectrum to the absorbanceSpectraPlotElement, by fitting a spline function to anchor points.
    function addAbsorbanceSpectrum() {
        // Calculate anchor points
        var A260 = Concentration * pathLength / AbsorbanceToConcentrationFactor;
        var A280 = A260 / A260A280;
        var A230 = A260 / A260A230;

        var x = [200, 230, 260, 280, 320, 350, 370];
        var y = [30, A230, A260, A280, backgroundSignal, backgroundSignal, backgroundSignal];

        var trace = {
            x: x,
            y: y,
            mode: 'lines',
            name: 'Sample ',// + sampleCount,
            line: {shape: 'spline'}
        };

        Plotly.addTraces(absorbanceSpectraPlotElement, trace);
    }

    // Clears the samples in the table. 
    function clearTable() {
        var table = document.getElementById("samplesTable");
        var rowCount = table.rows.length;
        for (var i = rowCount - 1; i > 0; i--) {
            table.deleteRow(i);
        }
        sampleCount = 0;

    }

    // Blanks the digital spectrophotometer with H2O.
    function blank() {
        blanked = true;

        // Reset the measures.
        document.getElementById("concentration").textContent = "";
        document.getElementById("A260/A280").textContent = "";
        document.getElementById("A260/A230").textContent = "";
    }

  </script>
</body>
</html>
